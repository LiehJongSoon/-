<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ìƒì£¼ë„í˜• ì†Œë¦¬ íŠ¹ì„± ì‹¤í—˜ì¥ì¹˜ êµìœ¡ íš¨ê³¼ ë¶„ì„ ì‹œìŠ¤í…œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #007bff;
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #e9ecef;
            border: none;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .nav-tab.active {
            background: #007bff;
            color: white;
        }
        
        .nav-tab:hover:not(.active) {
            background: #dee2e6;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
            min-height: 600px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 5px solid #28a745;
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .input-row label {
            font-weight: bold;
            color: #495057;
            font-size: 14px;
        }
        
        .input-row input, .input-row select {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .input-row input:focus, .input-row select:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-top: 25px;
        }
        
        .result-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #007bff;
        }
        
        .result-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .stat-label {
            font-weight: bold;
            color: #6c757d;
        }
        
        .stat-value {
            font-weight: bold;
            color: #007bff;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .significance {
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .significant {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .not-significant {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .effect-size {
            padding: 8px 12px;
            border-radius: 15px;
            display: inline-block;
            margin: 5px;
            font-weight: bold;
        }
        
        .small-effect {
            background: #fff3cd;
            color: #856404;
        }
        
        .medium-effect {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .large-effect {
            background: #d4edda;
            color: #155724;
        }
        
        .student-count {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #007bff;
            margin: 15px 0;
        }
        
        .export-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .data-table th,
        .data-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: center;
            font-size: 14px;
        }
        
        .data-table th {
            background: #007bff;
            color: white;
            font-weight: bold;
        }
        
        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .grade-selector {
            margin: 20px 0;
        }
        
        .grade-selector label {
            display: inline-block;
            margin-right: 20px;
            font-size: 16px;
            font-weight: bold;
        }
        
        .grade-selector input[type="radio"] {
            margin-right: 8px;
        }
        
        .section-title {
            font-size: 24px;
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            font-size: 18px;
            color: #007bff;
        }
        
        .loading.show {
            display: block;
        }
        
        .sample-data-btn {
            background: #17a2b8;
            color: white;
        }
        
        .sample-data-btn:hover {
            background: #138496;
        }
        
        .delete-btn {
            background: #6c757d;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .delete-btn:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¬ í•™ìƒì£¼ë„í˜• ì†Œë¦¬ íŠ¹ì„± ì‹¤í—˜ì¥ì¹˜ êµìœ¡ íš¨ê³¼ ë¶„ì„ ì‹œìŠ¤í…œ</h1>
            <p>ì‚¬ì „-ì‚¬í›„ ì„¤ë¬¸ ë°ì´í„° ì…ë ¥ ë° ì‹¤ì‹œê°„ í†µê³„ ë¶„ì„ | 2022 ê°œì • êµìœ¡ê³¼ì • ì—°ê³„</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('input')">ğŸ“ ë°ì´í„° ì…ë ¥</button>
            <button class="nav-tab" onclick="showTab('analysis')">ğŸ“Š í†µê³„ ë¶„ì„</button>
            <button class="nav-tab" onclick="showTab('charts')">ğŸ“ˆ ì‹œê°í™”</button>
            <button class="nav-tab" onclick="showTab('report')">ğŸ“‹ ë³´ê³ ì„œ</button>
        </div>
        
        <!-- ë°ì´í„° ì…ë ¥ íƒ­ -->
        <div id="input" class="tab-content active">
            <h2 class="section-title">ğŸ“ í•™ìƒ ë°ì´í„° ì…ë ¥</h2>
            
            <div class="alert alert-info">
                <strong>ì…ë ¥ ì•ˆë‚´:</strong> Aì˜ì—­(ì§€ì‹Â·ì´í•´), Bì˜ì—­(ê³¼ì •Â·ê¸°ëŠ¥), Cì˜ì—­(ê°€ì¹˜Â·íƒœë„), Eì˜ì—­(ì²´í—˜í‰ê°€) ì ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.<br>
                <strong>ì´ˆ5:</strong> Aì˜ì—­(5ì ), Bì˜ì—­(4ì ) | <strong>ì¤‘2:</strong> Aì˜ì—­(6ì ), Bì˜ì—­(5ì ) | <strong>C,Eì˜ì—­:</strong> 1-5ì  ì²™ë„
            </div>
            
            <div class="input-section">
                <h3>ğŸ¯ í•™ê¸‰ ì„ íƒ</h3>
                <div class="grade-selector">
                    <label>
                        <input type="radio" name="grade" value="elementary" checked onchange="updateInputHeaders()"> ì´ˆë“±í•™êµ 5í•™ë…„
                    </label>
                    <label>
                        <input type="radio" name="grade" value="middle" onchange="updateInputHeaders()"> ì¤‘í•™êµ 2í•™ë…„
                    </label>
                </div>
            </div>
            
            <div class="input-section">
                <h3>ğŸ“Š í•™ìƒë³„ ë°ì´í„° ì…ë ¥</h3>
                <div class="input-row" id="input-header">
                    <label>í•™ìƒë²ˆí˜¸</label>
                    <label>ì„±ë³„</label>
                    <label>Aì˜ì—­(ì‚¬ì „)</label>
                    <label>Aì˜ì—­(ì‚¬í›„)</label>
                    <label>Bì˜ì—­(ì‚¬ì „)</label>
                    <label>Bì˜ì—­(ì‚¬í›„)</label>
                    <label>Cì˜ì—­(ì‚¬ì „)</label>
                    <label>Cì˜ì—­(ì‚¬í›„)</label>
                    <label>Eì˜ì—­(í‰ê· )</label>
                </div>
                
                <div id="student-inputs">
                    <!-- í•™ìƒ ì…ë ¥ í¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="addStudent()">â• í•™ìƒ ì¶”ê°€</button>
<button class="btn btn-warning" onclick="uploadCSV()">ğŸ“¤ CSV ì—…ë¡œë“œ</button>
<input type="file" id="csv-file-input" accept=".csv" style="display: none;" onchange="handleCSVFile(event)">
                    <button class="btn sample-data-btn" onclick="loadSampleData()">ğŸ“‹ ìƒ˜í”Œ ë°ì´í„°</button>
                    <button class="btn btn-success" onclick="calculateResults()">ğŸ”„ ë¶„ì„ ì‹¤í–‰</button>
                    <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ</button>
                </div>
                
                <div class="student-count" id="student-count">ì…ë ¥ëœ í•™ìƒ ìˆ˜: 0ëª…</div>
            </div>
        </div>
        
        <!-- í†µê³„ ë¶„ì„ íƒ­ -->
        <div id="analysis" class="tab-content">
            <h2 class="section-title">ğŸ“Š í†µê³„ ë¶„ì„ ê²°ê³¼</h2>
            
            <div class="alert alert-warning" id="analysis-warning">
                ë¨¼ì € ë°ì´í„°ë¥¼ ì…ë ¥í•˜ê³  ë¶„ì„ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.
            </div>
            
            <div class="loading" id="analysis-loading">
                ğŸ”„ ë¶„ì„ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.
            </div>
            
            <div class="results-grid" id="analysis-results" style="display: none;">
                <div class="result-card">
                    <h3>ğŸ¯ Aì˜ì—­: ê³¼í•™ ì§€ì‹Â·ì´í•´</h3>
                    <div id="area-a-stats"></div>
                    <div id="area-a-significance"></div>
                </div>
                
                <div class="result-card">
                    <h3>ğŸ”¬ Bì˜ì—­: ê³¼ì •Â·ê¸°ëŠ¥</h3>
                    <div id="area-b-stats"></div>
                    <div id="area-b-significance"></div>
                </div>
                
                <div class="result-card">
                    <h3>â¤ï¸ Cì˜ì—­: ê°€ì¹˜Â·íƒœë„</h3>
                    <div id="area-c-stats"></div>
                    <div id="area-c-significance"></div>
                </div>
                
                <div class="result-card">
                    <h3>âœ¨ Eì˜ì—­: ì‹¤í—˜ ì²´í—˜</h3>
                    <div id="area-e-stats"></div>
                    <div id="area-e-significance"></div>
                </div>
            </div>
            
            <div id="summary-stats" style="display: none;">
                <!-- ì „ì²´ ìš”ì•½ í†µê³„ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
        
        <!-- ì‹œê°í™” íƒ­ -->
        <div id="charts" class="tab-content">
            <h2 class="section-title">ğŸ“ˆ ë°ì´í„° ì‹œê°í™”</h2>
            
            <div class="alert alert-info">
                ë¶„ì„ ì‹¤í–‰ í›„ ê·¸ë˜í”„ê°€ ìƒì„±ë©ë‹ˆë‹¤. ì‚¬ì „-ì‚¬í›„ ë¹„êµ, íš¨ê³¼í¬ê¸°, ê°œë³„ í•™ìƒ ë³€í™” ë“±ì„ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
            
            <div class="chart-container">
                <canvas id="beforeAfterChart"></canvas>
            </div>
            
            <div class="chart-container">
                <canvas id="effectSizeChart"></canvas>
            </div>
            
            <div class="chart-container">
                <canvas id="individualChart"></canvas>
            </div>
        </div>
        
        <!-- ë³´ê³ ì„œ íƒ­ -->
        <div id="report" class="tab-content">
            <h2 class="section-title">ğŸ“‹ ì—°êµ¬ ë³´ê³ ì„œ</h2>
            
            <div class="export-section">
                <h3>ğŸ† í•™ìƒì£¼ë„í˜• ì†Œë¦¬ íŠ¹ì„± ì‹¤í—˜ì¥ì¹˜ êµìœ¡ì ìš© ê²°ê³¼ ìš”ì•½</h3>
                <div id="report-content">
                    <div class="alert alert-warning">
                        ë¶„ì„ì„ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”. ê·¸ëŸ¬ë©´ ìë™ìœ¼ë¡œ ì—°êµ¬ ë³´ê³ ì„œê°€ ìƒì„±ë©ë‹ˆë‹¤.
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-success" onclick="exportToCSV()">ğŸ“„ CSV ë‹¤ìš´ë¡œë“œ</button>
                    <button class="btn btn-primary" onclick="printReport()">ğŸ–¨ï¸ ë³´ê³ ì„œ ì¸ì‡„</button>
                    <button class="btn sample-data-btn" onclick="copyResults()">ğŸ“‹ ê²°ê³¼ ë³µì‚¬</button>
                </div>
            </div>
            
            <div id="detailed-report" style="display: none;">
                <!-- ìƒì„¸ ë³´ê³ ì„œ ë‚´ìš©ì´ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ (Part 1ì—ì„œ ì´ˆê¸°í™”)
        let studentData = [];
        let currentGrade = 'elementary';
        let analysisResults = {};
        let charts = {};

        // ê¸°ë³¸ íƒ­ ì „í™˜ í•¨ìˆ˜ (Part 1 ì™„ì„±)
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.nav-tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Part 1 í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        function testPart1() {
            console.log('Part 1 HTML+CSS ë¡œë“œ ì™„ë£Œ!');
            console.log('ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™”:', { studentData, currentGrade, analysisResults });
            
            // ê¸°ë³¸ UI ìš”ì†Œ í™•ì¸
            const elements = {
                header: document.querySelector('.header'),
                navTabs: document.querySelectorAll('.nav-tab'),
                tabContents: document.querySelectorAll('.tab-content')
            };
            
            console.log('UI ìš”ì†Œ í™•ì¸:', elements);
            return elements;
        }

        // Part 1 ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            testPart1();
            console.log('ğŸ¯ Part 1 (HTML+CSS) ë¡œë“œ ì™„ë£Œ! ë‹¤ìŒ Partë¥¼ ì¶”ê°€í•˜ì„¸ìš”.');
        });
    </script>

  <script>
// ========================================
// Part 2: ë°ì´í„° ì…ë ¥ ê´€ë ¨ JavaScript í•¨ìˆ˜ë“¤
// ========================================

// í•™ê¸‰ ë³€ê²½ì‹œ ì…ë ¥ í—¤ë” ì—…ë°ì´íŠ¸
function updateInputHeaders() {
    const grade = document.querySelector('input[name="grade"]:checked').value;
    currentGrade = grade;
    
    const headerRow = document.getElementById('input-header');
    if (grade === 'elementary') {
        headerRow.innerHTML = `
            <label>í•™ìƒë²ˆí˜¸</label>
            <label>ì„±ë³„</label>
            <label>Aì˜ì—­(ì‚¬ì „/5)</label>
            <label>Aì˜ì—­(ì‚¬í›„/5)</label>
            <label>Bì˜ì—­(ì‚¬ì „/4)</label>
            <label>Bì˜ì—­(ì‚¬í›„/4)</label>
            <label>Cì˜ì—­(ì‚¬ì „/5)</label>
            <label>Cì˜ì—­(ì‚¬í›„/5)</label>
            <label>Eì˜ì—­(í‰ê· /5)</label>
        `;
    } else {
        headerRow.innerHTML = `
            <label>í•™ìƒë²ˆí˜¸</label>
            <label>ì„±ë³„</label>
            <label>Aì˜ì—­(ì‚¬ì „/6)</label>
            <label>Aì˜ì—­(ì‚¬í›„/6)</label>
            <label>Bì˜ì—­(ì‚¬ì „/5)</label>
            <label>Bì˜ì—­(ì‚¬í›„/5)</label>
            <label>Cì˜ì—­(ì‚¬ì „/5)</label>
            <label>Cì˜ì—­(ì‚¬í›„/5)</label>
            <label>Eì˜ì—­(í‰ê· /5)</label>
        `;
    }
    
    // ê¸°ì¡´ í•™ìƒ ë°ì´í„° ì´ˆê¸°í™”
    studentData = [];
    document.getElementById('student-inputs').innerHTML = '';
    updateStudentCount();
    console.log(`í•™ê¸‰ ë³€ê²½: ${grade}`);
}

// í•™ìƒ ì¶”ê°€ í•¨ìˆ˜
function addStudent() {
    const studentNum = studentData.length + 1;
    const inputContainer = document.getElementById('student-inputs');
    
    const studentRow = document.createElement('div');
    studentRow.className = 'input-row';
    studentRow.setAttribute('data-student-id', studentNum);
    
    const maxA = currentGrade === 'elementary' ? 5 : 6;
    const maxB = currentGrade === 'elementary' ? 4 : 5;
    
    studentRow.innerHTML = `
        <input type="text" value="${studentNum}" readonly>
        <select>
            <option value="M">ë‚¨</option>
            <option value="F">ì—¬</option>
        </select>
        <input type="number" min="0" max="${maxA}" step="1" placeholder="0">
        <input type="number" min="0" max="${maxA}" step="1" placeholder="0">
        <input type="number" min="0" max="${maxB}" step="1" placeholder="0">
        <input type="number" min="0" max="${maxB}" step="1" placeholder="0">
        <input type="number" min="1" max="5" step="0.1" placeholder="3.0">
        <input type="number" min="1" max="5" step="0.1" placeholder="3.0">
        <input type="number" min="1" max="5" step="0.1" placeholder="3.0">
        <button class="btn delete-btn" onclick="removeStudent(${studentNum})">âŒ</button>
    `;
    
    inputContainer.appendChild(studentRow);
    studentData.push({ id: studentNum });
    updateStudentCount();
    console.log(`í•™ìƒ ${studentNum} ì¶”ê°€ ì™„ë£Œ`);
}

// í•™ìƒ ì œê±° í•¨ìˆ˜
function removeStudent(studentId) {
    const studentRow = document.querySelector(`[data-student-id="${studentId}"]`);
    if (studentRow && confirm(`í•™ìƒ ${studentId}ë²ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        studentRow.remove();
        studentData = studentData.filter(s => s.id !== studentId);
        updateStudentCount();
        console.log(`í•™ìƒ ${studentId} ì‚­ì œ ì™„ë£Œ`);
    }
}

// í•™ìƒ ìˆ˜ ì—…ë°ì´íŠ¸
function updateStudentCount() {
    const count = document.querySelectorAll('#student-inputs .input-row').length;
    document.getElementById('student-count').textContent = `ì…ë ¥ëœ í•™ìƒ ìˆ˜: ${count}ëª…`;
}

// ìƒ˜í”Œ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
function loadSampleData() {
    if (confirm('ìƒ˜í”Œ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ê¸°ì¡´ ë°ì´í„°ëŠ” ì‚­ì œë©ë‹ˆë‹¤.')) {
        clearAllData();
        
        const sampleSize = currentGrade === 'elementary' ? 25 : 30;
        const maxA = currentGrade === 'elementary' ? 5 : 6;
        const maxB = currentGrade === 'elementary' ? 4 : 5;
        
        for (let i = 0; i < sampleSize; i++) {
            addStudent();
            
            // ë§ˆì§€ë§‰ì— ì¶”ê°€ëœ í•™ìƒ í–‰ ì°¾ê¸°
            const rows = document.querySelectorAll('#student-inputs .input-row');
            const lastRow = rows[rows.length - 1];
            const inputs = lastRow.querySelectorAll('input, select');
            
            // ì„±ë³„ ëœë¤ ì„¤ì •
            inputs[1].value = Math.random() > 0.5 ? 'M' : 'F';
            
            // Aì˜ì—­: ì‚¬ì „ 2-3ì , ì‚¬í›„ 4-5ì  (ê°•í•œ ê°œì„  íš¨ê³¼)
            inputs[2].value = Math.floor(Math.random() * 2) + 2; // 2-3ì 
            inputs[3].value = Math.floor(Math.random() * 2) + (maxA - 1); // 4-5ì  ë˜ëŠ” 5-6ì 
            
            // Bì˜ì—­: ì‚¬ì „ 1-2ì , ì‚¬í›„ 3-4ì  (ë§¤ìš° ê°•í•œ ê°œì„  íš¨ê³¼)
            inputs[4].value = Math.floor(Math.random() * 2) + 1; // 1-2ì 
            inputs[5].value = Math.floor(Math.random() * 2) + (maxB - 1); // 3-4ì  ë˜ëŠ” 4-5ì 
            
            // Cì˜ì—­: ì‚¬ì „ 2.5-3.5ì , ì‚¬í›„ 3.5-4.5ì  (ì¤‘ê°„ ê°œì„  íš¨ê³¼)
            inputs[6].value = (Math.random() * 1 + 2.5).toFixed(1); // 2.5-3.5ì 
            inputs[7].value = (Math.random() * 1 + 3.5).toFixed(1); // 3.5-4.5ì 
            
            // Eì˜ì—­: 4.0-4.8ì  (ë§¤ìš° ê¸ì •ì  ì²´í—˜)
            inputs[8].value = (Math.random() * 0.8 + 4.0).toFixed(1); // 4.0-4.8ì 
        }
        
        updateStudentCount();
        console.log(`ìƒ˜í”Œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ${sampleSize}ëª…`);
        
        // ìƒ˜í”Œ ë°ì´í„° ë¡œë“œ í›„ ìë™ ë¶„ì„ ì œì•ˆ
        if (confirm('ìƒ˜í”Œ ë°ì´í„°ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ë°”ë¡œ ë¶„ì„ì„ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            calculateResults();
        }
    }
}

// ì „ì²´ ë°ì´í„° ì‚­ì œ
function clearAllData() {
    if (studentData.length > 0 && !confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
    }
    
    studentData = [];
    document.getElementById('student-inputs').innerHTML = '';
    updateStudentCount();
    
    // ë¶„ì„ ê²°ê³¼ë„ ì´ˆê¸°í™”
    analysisResults = {};
    document.getElementById('analysis-warning').style.display = 'block';
    document.getElementById('analysis-results').style.display = 'none';
    
    // ì°¨íŠ¸ë„ ì´ˆê¸°í™”
    Object.keys(charts).forEach(key => {
        if (charts[key]) {
            charts[key].destroy();
            charts[key] = null;
        }
    });
    
    console.log('ëª¨ë“  ë°ì´í„° ì‚­ì œ ì™„ë£Œ');
}

// ë°ì´í„° ìˆ˜ì§‘ í•¨ìˆ˜ (ë¶„ì„ì— ì‚¬ìš©)
function collectData() {
    const rows = document.querySelectorAll('#student-inputs .input-row');
    const data = [];
    
    rows.forEach((row, index) => {
        const inputs = row.querySelectorAll('input, select');
        
        // ë¹ˆ ê°’ ì²´í¬
        const values = {
            id: inputs[0].value || `í•™ìƒ${index + 1}`,
            gender: inputs[1].value || 'M',
            a_pre: parseFloat(inputs[2].value) || 0,
            a_post: parseFloat(inputs[3].value) || 0,
            b_pre: parseFloat(inputs[4].value) || 0,
            b_post: parseFloat(inputs[5].value) || 0,
            c_pre: parseFloat(inputs[6].value) || 0,
            c_post: parseFloat(inputs[7].value) || 0,
            e_avg: parseFloat(inputs[8].value) || 0
        };
        
        data.push(values);
    });
    
    console.log('ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ:', data.length + 'ëª…');
    return data;
}

// ë°ì´í„° ìœ íš¨ì„± ê²€ì¦ í•¨ìˆ˜
function validateData(data) {
    const errors = [];
    const maxA = currentGrade === 'elementary' ? 5 : 6;
    const maxB = currentGrade === 'elementary' ? 4 : 5;
    
    data.forEach((student, index) => {
        const studentNum = index + 1;
        
        // Aì˜ì—­ ë²”ìœ„ ì²´í¬
        if (student.a_pre < 0 || student.a_pre > maxA) {
            errors.push(`í•™ìƒ ${studentNum}: Aì˜ì—­ ì‚¬ì „ì ìˆ˜ ë²”ìœ„ ì˜¤ë¥˜ (0-${maxA}ì )`);
        }
        if (student.a_post < 0 || student.a_post > maxA) {
            errors.push(`í•™ìƒ ${studentNum}: Aì˜ì—­ ì‚¬í›„ì ìˆ˜ ë²”ìœ„ ì˜¤ë¥˜ (0-${maxA}ì )`);
        }
        
        // Bì˜ì—­ ë²”ìœ„ ì²´í¬
        if (student.b_pre < 0 || student.b_pre > maxB) {
            errors.push(`í•™ìƒ ${studentNum}: Bì˜ì—­ ì‚¬ì „ì ìˆ˜ ë²”ìœ„ ì˜¤ë¥˜ (0-${maxB}ì )`);
        }
        if (student.b_post < 0 || student.b_post > maxB) {
            errors.push(`í•™ìƒ ${studentNum}: Bì˜ì—­ ì‚¬í›„ì ìˆ˜ ë²”ìœ„ ì˜¤ë¥˜ (0-${maxB}ì )`);
        }
        
        // Cì˜ì—­, Eì˜ì—­ ë²”ìœ„ ì²´í¬ (1-5ì )
        if (student.c_pre < 1 || student.c_pre > 5) {
            errors.push(`í•™ìƒ ${studentNum}: Cì˜ì—­ ì‚¬ì „ì ìˆ˜ ë²”ìœ„ ì˜¤ë¥˜ (1-5ì )`);
        }
        if (student.c_post < 1 || student.c_post > 5) {
            errors.push(`í•™ìƒ ${studentNum}: Cì˜ì—­ ì‚¬í›„ì ìˆ˜ ë²”ìœ„ ì˜¤ë¥˜ (1-5ì )`);
        }
        if (student.e_avg < 1 || student.e_avg > 5) {
            errors.push(`í•™ìƒ ${studentNum}: Eì˜ì—­ í‰ê· ì ìˆ˜ ë²”ìœ„ ì˜¤ë¥˜ (1-5ì )`);
        }
        
        // ë¹ˆ ê°’ ì²´í¬
        if (student.a_pre === 0 && student.a_post === 0) {
            errors.push(`í•™ìƒ ${studentNum}: Aì˜ì—­ ì ìˆ˜ê°€ ëª¨ë‘ 0ì…ë‹ˆë‹¤`);
        }
    });
    
    if (errors.length > 0) {
        console.error('ë°ì´í„° ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨:', errors);
        alert('ë°ì´í„° ì˜¤ë¥˜ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤:\n' + errors.slice(0, 5).join('\n') + 
              (errors.length > 5 ? '\n... ë“± ' + errors.length + 'ê°œ ì˜¤ë¥˜' : ''));
        return false;
    }
    
    console.log('ë°ì´í„° ìœ íš¨ì„± ê²€ì¦ í†µê³¼');
    return true;
}

// Part 2 í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
function testPart2() {
    console.log('ğŸ¯ Part 2 (ë°ì´í„° ì…ë ¥) í•¨ìˆ˜ë“¤ ë¡œë“œ ì™„ë£Œ!');
    
    // í•¨ìˆ˜ ì¡´ì¬ í™•ì¸
    const functions = {
        updateInputHeaders: typeof updateInputHeaders,
        addStudent: typeof addStudent,
        removeStudent: typeof removeStudent,
        loadSampleData: typeof loadSampleData,
        clearAllData: typeof clearAllData,
        collectData: typeof collectData,
        validateData: typeof validateData
    };
    
    console.log('Part 2 í•¨ìˆ˜ í™•ì¸:', functions);
    
    // ì´ˆê¸° ìƒíƒœ ì„¤ì •
    updateInputHeaders();
    
    return functions;
}

// Part 2 ë¡œë“œ ì™„ë£Œ ì‹œ ìë™ ì‹¤í–‰
if (typeof document !== 'undefined') {
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof testPart2 === 'function') {
            testPart2();
        }
    });
}
// CSV ì—…ë¡œë“œ í•¨ìˆ˜ë“¤
function uploadCSV() {
    document.getElementById('csv-file-input').click();
}

function handleCSVFile(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            parseCSV(e.target.result);
        };
        reader.readAsText(file);
    }
}

function parseCSV(csvText) {
    const lines = csvText.split('\n');
    const headers = lines[0].split(',');
    
    clearAllData();
    
    for (let i = 1; i < lines.length; i++) {
        if (lines[i].trim()) {
            const values = lines[i].split(',');
            addStudent();
            
            const rows = document.querySelectorAll('#student-inputs .input-row');
            const lastRow = rows[rows.length - 1];
            const inputs = lastRow.querySelectorAll('input, select');
            
            // CSV ë°ì´í„° ì…ë ¥
            if (values.length >= 9) {
                inputs[1].value = values[1] || 'M';
                inputs[2].value = values[2] || '0';
                inputs[3].value = values[3] || '0';
                inputs[4].value = values[4] || '0';
                inputs[5].value = values[5] || '0';
                inputs[6].value = values[6] || '0';
                inputs[7].value = values[7] || '0';
                inputs[8].value = values[8] || '0';
            }
        }
    }
    
    updateStudentCount();
    alert('CSV íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
}
console.log('ğŸ“ Part 2 JavaScript ë¡œë“œ ì™„ë£Œ!');
</script>

<script>
// ========================================
// Part 3: í†µê³„ ë¶„ì„ ê´€ë ¨ JavaScript í•¨ìˆ˜ë“¤
// ========================================

// ê¸°ë³¸ í†µê³„ í•¨ìˆ˜ë“¤
function calculateMean(arr) {
    if (arr.length === 0) return 0;
    return arr.reduce((sum, val) => sum + val, 0) / arr.length;
}

function calculateSD(arr) {
    if (arr.length === 0) return 0;
    const mean = calculateMean(arr);
    const squaredDiffs = arr.map(val => Math.pow(val - mean, 2));
    return Math.sqrt(calculateMean(squaredDiffs));
}

function calculateSEM(arr) {
    if (arr.length === 0) return 0;
    return calculateSD(arr) / Math.sqrt(arr.length);
}

// ëŒ€ì‘í‘œë³¸ t-ê²€ì • í•¨ìˆ˜
function pairedTTest(pre, post) {
    const n = pre.length;
    if (n === 0) return null;
    
    const diff = pre.map((p, i) => post[i] - p);
    const meanDiff = calculateMean(diff);
    const sdDiff = calculateSD(diff);
    const semDiff = sdDiff / Math.sqrt(n);
    
    const tStat = meanDiff / semDiff;
    const df = n - 1;
    
    // t ë¶„í¬ ì„ê³„ê°’ (ê·¼ì‚¬ì¹˜)
    const tCritical = getTCritical(df);
    const pValue = calculatePValue(Math.abs(tStat), df);
    
    return {
        n: n,
        meanDiff: meanDiff,
        sdDiff: sdDiff,
        semDiff: semDiff,
        tStat: tStat,
        df: df,
        pValue: pValue,
        significant: pValue < 0.05,
        tCritical: tCritical
    };
}

// t ë¶„í¬ ì„ê³„ê°’ ê³„ì‚° (ê·¼ì‚¬ì¹˜)
function getTCritical(df) {
    // Î± = 0.05, ë‹¨ì¸¡ê²€ì • ê¸°ì¤€
    const tTable = {
        1: 6.314, 5: 2.015, 10: 1.812, 15: 1.753, 20: 1.725,
        25: 1.708, 30: 1.697, 40: 1.684, 60: 1.671, 100: 1.660, 1000: 1.645
    };
    
    // ê°€ì¥ ê°€ê¹Œìš´ df ì°¾ê¸°
    const keys = Object.keys(tTable).map(Number).sort((a, b) => a - b);
    for (let i = 0; i < keys.length; i++) {
        if (df <= keys[i]) return tTable[keys[i]];
    }
    return 1.645; // ë¬´í•œëŒ€ ê·¼ì‚¬
}

// pê°’ ê³„ì‚° (ê·¼ì‚¬ì¹˜)
function calculatePValue(tAbs, df) {
    // ê°„ë‹¨í•œ ê·¼ì‚¬ ê³µì‹ ì‚¬ìš©
    if (df < 1) return 1;
    
    const tCrit_05 = getTCritical(df);
    const tCrit_01 = tCrit_05 * 1.3; // ëŒ€ëµì  ë¹„ìœ¨
    const tCrit_001 = tCrit_05 * 1.6;
    
    if (tAbs >= tCrit_001) return 0.001;
    else if (tAbs >= tCrit_01) return 0.01;
    else if (tAbs >= tCrit_05) return 0.05;
    else return 0.1; // ìœ ì˜í•˜ì§€ ì•ŠìŒ
}

// Cohen's d íš¨ê³¼í¬ê¸° ê³„ì‚°
function calculateCohenD(pre, post) {
    if (pre.length === 0) return 0;
    
    const preMean = calculateMean(pre);
    const postMean = calculateMean(post);
    const meanDiff = postMean - preMean;
    
    const preSD = calculateSD(pre);
    const postSD = calculateSD(post);
    const pooledSD = Math.sqrt((Math.pow(preSD, 2) + Math.pow(postSD, 2)) / 2);
    
    return pooledSD > 0 ? meanDiff / pooledSD : 0;
}

// íš¨ê³¼í¬ê¸° í•´ì„ í•¨ìˆ˜
function interpretEffectSize(d) {
    const absD = Math.abs(d);
    if (absD >= 0.8) return { label: 'í° íš¨ê³¼', class: 'large-effect', color: '#28a745' };
    else if (absD >= 0.5) return { label: 'ì¤‘ê°„ íš¨ê³¼', class: 'medium-effect', color: '#17a2b8' };
    else if (absD >= 0.2) return { label: 'ì‘ì€ íš¨ê³¼', class: 'small-effect', color: '#ffc107' };
    else return { label: 'íš¨ê³¼ ì—†ìŒ', class: 'no-effect', color: '#6c757d' };
}

// ì¼í‘œë³¸ t-ê²€ì • (Eì˜ì—­ìš©)
function oneSampleTTest(data, testValue = 3.0) {
    const n = data.length;
    if (n === 0) return null;
    
    const mean = calculateMean(data);
    const sd = calculateSD(data);
    const sem = sd / Math.sqrt(n);
    const tStat = (mean - testValue) / sem;
    const df = n - 1;
    const pValue = calculatePValue(Math.abs(tStat), df);
    
    return {
        n: n,
        mean: mean,
        sd: sd,
        sem: sem,
        testValue: testValue,
        tStat: tStat,
        df: df,
        pValue: pValue,
        significant: pValue < 0.05,
        aboveNeutral: mean > testValue
    };
}

// ë©”ì¸ ë¶„ì„ ì‹¤í–‰ í•¨ìˆ˜
function calculateResults() {
    // ë¡œë”© í‘œì‹œ
    document.getElementById('analysis-loading').classList.add('show');
    document.getElementById('analysis-warning').style.display = 'none';
    
    setTimeout(() => {
        try {
            const data = collectData();
            
            if (data.length === 0) {
                alert('ì…ë ¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € í•™ìƒ ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                document.getElementById('analysis-loading').classList.remove('show');
                document.getElementById('analysis-warning').style.display = 'block';
                return;
            }
            
            if (!validateData(data)) {
                document.getElementById('analysis-loading').classList.remove('show');
                document.getElementById('analysis-warning').style.display = 'block';
                return;
            }
            
            // ê° ì˜ì—­ë³„ ë°ì´í„° ì¶”ì¶œ
            const areas = {
                a: {
                    pre: data.map(d => d.a_pre),
                    post: data.map(d => d.a_post)
                },
                b: {
                    pre: data.map(d => d.b_pre),
                    post: data.map(d => d.b_post)
                },
                c: {
                    pre: data.map(d => d.c_pre),
                    post: data.map(d => d.c_post)
                },
                e: {
                    data: data.map(d => d.e_avg)
                }
            };
            
            // ê° ì˜ì—­ë³„ ë¶„ì„ ì‹¤í–‰
            analysisResults = {};
            
            // A, B, C ì˜ì—­: ëŒ€ì‘í‘œë³¸ t-ê²€ì •
            ['a', 'b', 'c'].forEach(area => {
                const tTest = pairedTTest(areas[area].pre, areas[area].post);
                const cohenD = calculateCohenD(areas[area].pre, areas[area].post);
                
                analysisResults[area] = {
                    pre_mean: calculateMean(areas[area].pre),
                    pre_sd: calculateSD(areas[area].pre),
                    post_mean: calculateMean(areas[area].post),
                    post_sd: calculateSD(areas[area].post),
                    improvement: calculateMean(areas[area].post) - calculateMean(areas[area].pre),
                    improvementPercent: ((calculateMean(areas[area].post) - calculateMean(areas[area].pre)) / 
                                       (currentGrade === 'elementary' ? (area === 'b' ? 4 : 5) : (area === 'a' ? 6 : 5)) * 100),
                    tTest: tTest,
                    cohenD: cohenD,
                    effectSize: interpretEffectSize(cohenD),
                    n: data.length
                };
            });
            
            // Eì˜ì—­: ì¼í‘œë³¸ t-ê²€ì •
            const eTest = oneSampleTTest(areas.e.data, 3.0);
            analysisResults.e = {
                mean: calculateMean(areas.e.data),
                sd: calculateSD(areas.e.data),
                oneSampleTest: eTest,
                n: data.length
            };
            
            // ê²°ê³¼ í‘œì‹œ
            displayAnalysisResults();
            
            // ì°¨íŠ¸ ìƒì„± (Part 4ì—ì„œ êµ¬í˜„)
            if (typeof createCharts === 'function') {
                createCharts();
            }
            
            // ë³´ê³ ì„œ ìƒì„± (Part 4ì—ì„œ êµ¬í˜„)
            if (typeof generateReport === 'function') {
                generateReport();
            }
            
            console.log('ë¶„ì„ ì™„ë£Œ:', analysisResults);
            
        } catch (error) {
            console.error('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        } finally {
            document.getElementById('analysis-loading').classList.remove('show');
        }
    }, 500); // ë¡œë”© íš¨ê³¼ë¥¼ ìœ„í•œ ì§€ì—°
}

// ë¶„ì„ ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
function displayAnalysisResults() {
    document.getElementById('analysis-results').style.display = 'grid';
    
    // A, B, C ì˜ì—­ ê²°ê³¼ í‘œì‹œ
    ['a', 'b', 'c'].forEach(area => {
        const result = analysisResults[area];
        const statsDiv = document.getElementById(`area-${area}-stats`);
        const sigDiv = document.getElementById(`area-${area}-significance`);
        
        // ê¸°ë³¸ í†µê³„
        statsDiv.innerHTML = `
            <div class="stat-item">
                <span class="stat-label">í‘œë³¸ í¬ê¸°:</span>
                <span class="stat-value">${result.n}ëª…</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ì‚¬ì „ í‰ê· :</span>
                <span class="stat-value">${result.pre_mean.toFixed(2)} Â± ${result.pre_sd.toFixed(2)}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ì‚¬í›„ í‰ê· :</span>
                <span class="stat-value">${result.post_mean.toFixed(2)} Â± ${result.post_sd.toFixed(2)}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">í–¥ìƒë„:</span>
                <span class="stat-value">+${result.improvement.toFixed(2)}ì  (${result.improvementPercent.toFixed(1)}%)</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">tê°’:</span>
                <span class="stat-value">${result.tTest.tStat.toFixed(3)} (df=${result.tTest.df})</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">pê°’:</span>
                <span class="stat-value">${result.tTest.pValue < 0.001 ? '<0.001' : result.tTest.pValue.toFixed(3)}</span>
            </div>
        `;
        
        // ìœ ì˜ì„± ë° íš¨ê³¼í¬ê¸°
        sigDiv.innerHTML = `
            <div class="${result.tTest.significant ? 'significance significant' : 'significance not-significant'}">
                ${result.tTest.significant ? 
                  `í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•¨ âœ… (p ${result.tTest.pValue < 0.001 ? '<0.001' : '='+result.tTest.pValue.toFixed(3)})` : 
                  'í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•˜ì§€ ì•ŠìŒ âŒ'}
            </div>
            <div class="effect-size ${result.effectSize.class}">
                íš¨ê³¼í¬ê¸°: d = ${result.cohenD.toFixed(3)} (${result.effectSize.label})
            </div>
                 `;
    });
    
    // Eì˜ì—­ ê²°ê³¼ í‘œì‹œ
    const eResult = analysisResults.e;
    document.getElementById('area-e-stats').innerHTML = `
        <div class="stat-item">
            <span class="stat-label">í‘œë³¸ í¬ê¸°:</span>
            <span class="stat-value">${eResult.n}ëª…</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">í‰ê·  ì ìˆ˜:</span>
            <span class="stat-value">${eResult.mean.toFixed(2)} Â± ${eResult.sd.toFixed(2)}</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">5ì  ë§Œì  í™˜ì‚°:</span>
            <span class="stat-value">${eResult.mean.toFixed(1)}/5.0ì </span>
        </div>
        <div class="stat-item">
            <span class="stat-label">ë³´í†µ(3.0)ê³¼ ë¹„êµ:</span>
            <span class="stat-value">+${(eResult.mean - 3.0).toFixed(2)}ì </span>
        </div>
        <div class="stat-item">
            <span class="stat-label">tê°’:</span>
            <span class="stat-value">${eResult.oneSampleTest.tStat.toFixed(3)}</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">pê°’:</span>
            <span class="stat-value">${eResult.oneSampleTest.pValue < 0.001 ? '<0.001' : eResult.oneSampleTest.pValue.toFixed(3)}</span>
        </div>
    `;
    
    document.getElementById('area-e-significance').innerHTML = `
        <div class="${eResult.oneSampleTest.significant && eResult.oneSampleTest.aboveNeutral ? 
                    'significance significant' : 'significance not-significant'}">
            ${eResult.oneSampleTest.significant && eResult.oneSampleTest.aboveNeutral ? 
              'ì‹¤í—˜ ì²´í—˜ ë§¤ìš° ê¸ì •ì ! âœ¨' : 'ì‹¤í—˜ ì²´í—˜ ë³´í†µ ìˆ˜ì¤€'}
        </div>
        ${eResult.mean >= 4.0 ? 
          '<div class="alert alert-success" style="margin-top: 10px; padding: 8px;">ğŸŒŸ ë§¤ìš° ë†’ì€ ë§Œì¡±ë„!</div>' : ''}
    `;
    
    // ì „ì²´ ìš”ì•½ í‘œì‹œ
    displaySummaryStats();
}

// ì „ì²´ ìš”ì•½ í†µê³„ í‘œì‹œ
function displaySummaryStats() {
    const summaryDiv = document.getElementById('summary-stats');
    if (!summaryDiv) return;
    
    const significantAreas = ['a', 'b', 'c'].filter(area => 
        analysisResults[area].tTest.significant && analysisResults[area].cohenD > 0
    );
    
    const largeEffects = ['a', 'b', 'c'].filter(area => 
        Math.abs(analysisResults[area].cohenD) >= 0.8
    );
    
    const avgImprovement = ['a', 'b', 'c'].reduce((sum, area) => 
        sum + analysisResults[area].improvementPercent, 0) / 3;
    
    summaryDiv.innerHTML = `
        <div class="result-card" style="grid-column: 1 / -1; border-left-color: #28a745;">
            <h3>ğŸ¯ ì „ì²´ ì—°êµ¬ ìš”ì•½</h3>
            <div class="stat-item">
                <span class="stat-label">ë¶„ì„ ëŒ€ìƒ:</span>
                <span class="stat-value">${analysisResults.a.n}ëª… (${currentGrade === 'elementary' ? 'ì´ˆë“± 5í•™ë…„' : 'ì¤‘í•™êµ 2í•™ë…„'})</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ìœ ì˜í•œ íš¨ê³¼:</span>
                <span class="stat-value">${significantAreas.length}/3ê°œ ì˜ì—­</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">í° íš¨ê³¼í¬ê¸°:</span>
                <span class="stat-value">${largeEffects.length}/3ê°œ ì˜ì—­</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">í‰ê·  í–¥ìƒë¥ :</span>
                <span class="stat-value">${avgImprovement.toFixed(1)}%</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ì²´í—˜ ë§Œì¡±ë„:</span>
                <span class="stat-value">${analysisResults.e.mean.toFixed(1)}/5.0ì </span>
            </div>
     ${significantAreas.length >= 2 && largeEffects.length >= 2 ? 
              '<div class="alert alert-success" style="margin-top: 15px;">ğŸ”¬ ê³¼í•™êµìœ¡ ê°œì„ ì— ê¸°ì—¬í•  ìˆ˜ ìˆëŠ” ê²°ê³¼!</div>' :
              significantAreas.length >= 2 && largeEffects.length >= 1 ?
              '<div class="alert alert-success" style="margin-top: 15px;">âœ¨ ì‹¤ì œ êµìœ¡í˜„ì¥ ì ìš© ê°€ëŠ¥í•œ ê²°ê³¼!</div>' : ''}
        </div>
    `;
    
    summaryDiv.style.display = 'block';
}

// ê°œë³„ í•™ìƒ ë¶„ì„ í•¨ìˆ˜
function analyzeIndividualStudents() {
    const data = collectData();
    const improvements = data.map(student => ({
        id: student.id,
        a_improvement: student.a_post - student.a_pre,
        b_improvement: student.b_post - student.b_pre,
        c_improvement: student.c_post - student.c_pre,
        total_improvement: (student.a_post - student.a_pre) + (student.b_post - student.b_pre) + (student.c_post - student.c_pre),
        e_score: student.e_avg
    }));
    
    return improvements;
}

// Part 3 í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
function testPart3() {
    console.log('ğŸ¯ Part 3 (í†µê³„ ë¶„ì„) í•¨ìˆ˜ë“¤ ë¡œë“œ ì™„ë£Œ!');
    
    const functions = {
        calculateMean: typeof calculateMean,
        calculateSD: typeof calculateSD,
        pairedTTest: typeof pairedTTest,
        calculateCohenD: typeof calculateCohenD,
        oneSampleTTest: typeof oneSampleTTest,
        calculateResults: typeof calculateResults,
        displayAnalysisResults: typeof displayAnalysisResults
    };
    
    console.log('Part 3 í•¨ìˆ˜ í™•ì¸:', functions);
    
    // ìƒ˜í”Œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸
    const testData = [1, 2, 3, 4, 5];
    console.log('í…ŒìŠ¤íŠ¸ - í‰ê· :', calculateMean(testData));
    console.log('í…ŒìŠ¤íŠ¸ - í‘œì¤€í¸ì°¨:', calculateSD(testData));
    
    return functions;
}

// Part 3 ë¡œë“œ ì™„ë£Œ ì‹œ ìë™ ì‹¤í–‰
if (typeof document !== 'undefined') {
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof testPart3 === 'function') {
            testPart3();
        }
    });
}

console.log('ğŸ“Š Part 3 JavaScript ë¡œë“œ ì™„ë£Œ!');
</script>

<script>
// ========================================
// Part 4A: ì°¨íŠ¸ ìƒì„± ê´€ë ¨ JavaScript í•¨ìˆ˜ë“¤
// ========================================

// ì°¨íŠ¸ ìƒì„± ë©”ì¸ í•¨ìˆ˜
function createCharts() {
    if (!analysisResults || Object.keys(analysisResults).length === 0) {
        console.warn('ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë¶„ì„ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    // ê¸°ì¡´ ì°¨íŠ¸ ì‚­ì œ
    destroyExistingCharts();
    
    // ê° ì°¨íŠ¸ ìƒì„±
    createBeforeAfterChart();
    createEffectSizeChart();
    createIndividualChangeChart();
    
    console.log('ëª¨ë“  ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
}

// ê¸°ì¡´ ì°¨íŠ¸ ì‚­ì œ í•¨ìˆ˜
function destroyExistingCharts() {
    Object.keys(charts).forEach(key => {
        if (charts[key] && typeof charts[key].destroy === 'function') {
            charts[key].destroy();
            charts[key] = null;
        }
    });
}

// ì‚¬ì „-ì‚¬í›„ ë¹„êµ ì°¨íŠ¸
function createBeforeAfterChart() {
    const ctx = document.getElementById('beforeAfterChart');
    if (!ctx) return;
    
    const areas = ['a', 'b', 'c'];
    const areaNames = ['Aì˜ì—­ (ì§€ì‹Â·ì´í•´)', 'Bì˜ì—­ (ê³¼ì •Â·ê¸°ëŠ¥)', 'Cì˜ì—­ (ê°€ì¹˜Â·íƒœë„)'];
    
    const preData = areas.map(area => analysisResults[area].pre_mean);
    const postData = areas.map(area => analysisResults[area].post_mean);
    const maxScore = currentGrade === 'elementary' ? 5 : 6;
    
    charts.beforeAfter = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: areaNames,
            datasets: [
                {
                    label: 'ì‚¬ì „ ì ìˆ˜',
                    data: preData,
                    backgroundColor: 'rgba(54, 162, 235, 0.7)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 2,
                    borderRadius: 5
                },
                {
                    label: 'ì‚¬í›„ ì ìˆ˜',
                    data: postData,
                    backgroundColor: 'rgba(75, 192, 192, 0.7)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2,
                    borderRadius: 5
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: `ì‚¬ì „-ì‚¬í›„ ì ìˆ˜ ë¹„êµ (${currentGrade === 'elementary' ? 'ì´ˆë“± 5í•™ë…„' : 'ì¤‘í•™êµ 2í•™ë…„'})`,
                    font: { size: 18, weight: 'bold' },
                    padding: 20
                },
                legend: {
                    position: 'top',
                    labels: { font: { size: 14 } }
                },
                tooltip: {
                    callbacks: {
                        afterLabel: function(context) {
                            const areaIndex = context.dataIndex;
                            const area = areas[areaIndex];
                            const improvement = analysisResults[area].improvement;
                            const percent = analysisResults[area].improvementPercent;
                            return `í–¥ìƒ: +${improvement.toFixed(2)}ì  (${percent.toFixed(1)}%)`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: maxScore,
                    title: {
                        display: true,
                        text: 'ì ìˆ˜',
                        font: { size: 14, weight: 'bold' }
                    },
                    grid: { color: 'rgba(0,0,0,0.1)' }
                },
                x: {
                    title: {
                        display: true,
                        text: 'ì¸¡ì • ì˜ì—­',
                        font: { size: 14, weight: 'bold' }
                    }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeInOutQuart'
            }
        }
    });
}

// íš¨ê³¼í¬ê¸° ì°¨íŠ¸
function createEffectSizeChart() {
    const ctx = document.getElementById('effectSizeChart');
    if (!ctx) return;
    
    const areas = ['a', 'b', 'c'];
    const areaNames = ['Aì˜ì—­', 'Bì˜ì—­', 'Cì˜ì—­'];
    const effectSizes = areas.map(area => analysisResults[area].cohenD);
    
    // íš¨ê³¼í¬ê¸°ì— ë”°ë¥¸ ìƒ‰ìƒ ê²°ì •
    const colors = effectSizes.map(d => {
        const absD = Math.abs(d);
        if (absD >= 0.8) return 'rgba(40, 167, 69, 0.8)';      // í° íš¨ê³¼ - ì´ˆë¡
        else if (absD >= 0.5) return 'rgba(23, 162, 184, 0.8)'; // ì¤‘ê°„ íš¨ê³¼ - íŒŒë‘
        else if (absD >= 0.2) return 'rgba(255, 193, 7, 0.8)';  // ì‘ì€ íš¨ê³¼ - ë…¸ë‘
        else return 'rgba(108, 117, 125, 0.8)';                  // íš¨ê³¼ ì—†ìŒ - íšŒìƒ‰
    });
    
    charts.effectSize = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: areaNames,
            datasets: [{
                label: "Cohen's d (íš¨ê³¼í¬ê¸°)",
                data: effectSizes,
                backgroundColor: colors,
                borderColor: colors.map(color => color.replace('0.8', '1')),
                borderWidth: 2,
                borderRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'ì˜ì—­ë³„ íš¨ê³¼í¬ê¸° (Cohen\'s d)',
                    font: { size: 18, weight: 'bold' },
                    padding: 20
                },
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        afterLabel: function(context) {
                            const d = context.parsed.y;
                            const absD = Math.abs(d);
                            let interpretation = '';
                            if (absD >= 0.8) interpretation = 'í° íš¨ê³¼';
                            else if (absD >= 0.5) interpretation = 'ì¤‘ê°„ íš¨ê³¼';
                            else if (absD >= 0.2) interpretation = 'ì‘ì€ íš¨ê³¼';
                            else interpretation = 'íš¨ê³¼ ì—†ìŒ';
                            return `í•´ì„: ${interpretation}`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    title: {
                        display: true,
                        text: 'Cohen\'s d',
                        font: { size: 14, weight: 'bold' }
                    },
                    grid: { color: 'rgba(0,0,0,0.1)' }
                },
                x: {
                    title: {
                        display: true,
                        text: 'ì¸¡ì • ì˜ì—­',
                        font: { size: 14, weight: 'bold' }
                    }
                }
            },
            animation: {
                duration: 2000,
                easing: 'easeOutBounce'
            }
        }
    });
}

// ê°œë³„ í•™ìƒ ë³€í™” ì°¨íŠ¸
function createIndividualChangeChart() {
    const ctx = document.getElementById('individualChart');
    if (!ctx) return;
    
    const data = collectData();
    if (data.length === 0) return;
    
    // ê°œë³„ í•™ìƒì˜ ì´ í–¥ìƒë„ ê³„ì‚°
    const improvements = data.map((student, index) => ({
        label: `í•™ìƒ${index + 1}`,
        total: (student.a_post - student.a_pre) + 
               (student.b_post - student.b_pre) + 
               (student.c_post - student.c_pre),
        a: student.a_post - student.a_pre,
        b: student.b_post - student.b_pre,
        c: student.c_post - student.c_pre
    }));
    
    // ì´ í–¥ìƒë„ìˆœìœ¼ë¡œ ì •ë ¬
    improvements.sort((a, b) => b.total - a.total);
    
    charts.individual = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: improvements.map(item => item.label),
            datasets: [
                {
                    label: 'Aì˜ì—­ í–¥ìƒ',
                    data: improvements.map(item => item.a),
                    backgroundColor: 'rgba(255, 99, 132, 0.7)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Bì˜ì—­ í–¥ìƒ',
                    data: improvements.map(item => item.b),
                    backgroundColor: 'rgba(54, 162, 235, 0.7)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Cì˜ì—­ í–¥ìƒ',
                    data: improvements.map(item => item.c),
                    backgroundColor: 'rgba(75, 192, 192, 0.7)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'ê°œë³„ í•™ìƒ ì˜ì—­ë³„ í–¥ìƒë„',
                    font: { size: 18, weight: 'bold' },
                    padding: 20
                },
                legend: {
                    position: 'top',
                    labels: { font: { size: 12 } }
                }
            },
            scales: {
                x: {
                    stacked: true,
                    title: {
                        display: true,
                        text: 'í•™ìƒ (í–¥ìƒë„ ë†’ì€ ìˆœ)',
                        font: { size: 14, weight: 'bold' }
                    }
                },
                y: {
                    stacked: true,
                    title: {
                        display: true,
                        text: 'ì ìˆ˜ í–¥ìƒ',
                        font: { size: 14, weight: 'bold' }
                    },
                    grid: { color: 'rgba(0,0,0,0.1)' }
                }
            },
            animation: {
                duration: 1000,
                easing: 'easeInOutQuad'
            }
        }
    });
}

// Part 4A í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
function testPart4A() {
    console.log('ğŸ¯ Part 4A (ì°¨íŠ¸ ìƒì„±) í•¨ìˆ˜ë“¤ ë¡œë“œ ì™„ë£Œ!');
    
    const functions = {
        createCharts: typeof createCharts,
        createBeforeAfterChart: typeof createBeforeAfterChart,
        createEffectSizeChart: typeof createEffectSizeChart,
        createIndividualChangeChart: typeof createIndividualChangeChart,
        destroyExistingCharts: typeof destroyExistingCharts
    };
    
    console.log('Part 4A í•¨ìˆ˜ í™•ì¸:', functions);
    return functions;
}

console.log('ğŸ“ˆ Part 4A JavaScript ë¡œë“œ ì™„ë£Œ!');
</script>

<script>
// ========================================
// Part 4B: ë³´ê³ ì„œ ìƒì„± ê´€ë ¨ JavaScript í•¨ìˆ˜ë“¤
// ========================================

// ë³´ê³ ì„œ ìƒì„± ë©”ì¸ í•¨ìˆ˜
function generateReport() {
    if (!analysisResults || Object.keys(analysisResults).length === 0) {
        console.warn('ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    const reportContent = document.getElementById('report-content');
    const detailedReport = document.getElementById('detailed-report');
    
    if (!reportContent || !detailedReport) return;
    
    // ìš”ì•½ ë³´ê³ ì„œ
    const summaryHTML = generateSummaryReport();
    reportContent.innerHTML = summaryHTML;
    
    // ìƒì„¸ ë³´ê³ ì„œ
    const detailedHTML = generateDetailedReport();
    detailedReport.innerHTML = detailedHTML;
    detailedReport.style.display = 'block';
    
    console.log('ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ');
}

// ìš”ì•½ ë³´ê³ ì„œ ìƒì„±
function generateSummaryReport() {
    const n = analysisResults.a.n;
    const grade = currentGrade === 'elementary' ? 'ì´ˆë“±í•™êµ 5í•™ë…„' : 'ì¤‘í•™êµ 2í•™ë…„';
    
    const significantCount = ['a', 'b', 'c'].filter(area => 
        analysisResults[area].tTest.significant
    ).length;
    
    const largeEffectCount = ['a', 'b', 'c'].filter(area => 
        Math.abs(analysisResults[area].cohenD) >= 0.8
    ).length;
    
    const avgSatisfaction = analysisResults.e.mean;
    
    return `
        <div class="alert alert-success">
            <h4>ğŸ† ì—°êµ¬ ê²°ê³¼ ìš”ì•½</h4>
            <p><strong>ì—°êµ¬ ëŒ€ìƒ:</strong> ${grade} ${n}ëª…</p>
            <p><strong>ìœ ì˜í•œ íš¨ê³¼:</strong> ${significantCount}/3ê°œ ì˜ì—­ì—ì„œ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•œ í–¥ìƒ</p>
            <p><strong>í° íš¨ê³¼í¬ê¸°:</strong> ${largeEffectCount}/3ê°œ ì˜ì—­ì—ì„œ Cohen's d â‰¥ 0.8</p>
            <p><strong>ì‹¤í—˜ ë§Œì¡±ë„:</strong> ${avgSatisfaction.toFixed(1)}/5.0ì  (${avgSatisfaction >= 4.0 ? 'ë§¤ìš° ë†’ìŒ' : 'ë†’ìŒ'})</p>
            
       ${(() => {
    let resultMessage = '';
    if (significantCount === 3 && largeEffectCount >= 2) {
        resultMessage = 'ğŸ¯ ì „ ì˜ì—­ í†µê³„ì  ìœ ì˜ì„± ë‹¬ì„±! íƒì›”í•œ êµìœ¡ íš¨ê³¼!<br>ğŸ“Š í° íš¨ê³¼í¬ê¸° ë‹¤ìˆ˜ ì˜ì—­ì—ì„œ í™•ì¸!<br>ğŸ”¬ ê³¼í•™êµìœ¡ í˜ì‹ ì— í¬ê²Œ ê¸°ì—¬í•  ìˆ˜ ìˆëŠ” ì—°êµ¬!';
    } else if (significantCount >= 2 && largeEffectCount >= 1) {
        resultMessage = 'ğŸ“ˆ 2/3ê°œ ì˜ì—­ì—ì„œ í†µê³„ì  ìœ ì˜ì„± í™•ì¸!<br>ğŸ“Š ì‹¤í—˜ì¥ì¹˜ì˜ êµìœ¡ì  íš¨ê³¼ì„± ì…ì¦!<br>ğŸ”¬ ê³¼í•™êµìœ¡ ê°œì„ ì— ê¸°ì—¬í•  ìˆ˜ ìˆëŠ” ê²°ê³¼!<br>ğŸ“Š í° íš¨ê³¼í¬ê¸°(dâ‰¥0.8) ë‹¬ì„±!';
    } else if (significantCount >= 1) {
        resultMessage = 'ğŸ“Š ì¼ë¶€ ì˜ì—­ì—ì„œ êµìœ¡ íš¨ê³¼ í™•ì¸<br>ğŸ” ì¶”ê°€ ê°œì„ ì„ í†µí•œ íš¨ê³¼ í–¥ìƒ ê°€ëŠ¥ì„±';
    } else {
        resultMessage = 'ğŸ“‹ ì‹¤í—˜ì¥ì¹˜ ê°œì„ ì„ í†µí•œ íš¨ê³¼ í–¥ìƒ í•„ìš”<br>ğŸ”§ ì¶”ê°€ ì—°êµ¬ ë° ë³´ì™„ ë°©í–¥ ë„ì¶œ';
    }
    return resultMessage ? `<p style="color: #28a745; font-weight: bold; margin-top: 10px;">${resultMessage}</p>` : '';
})()}
        </div>
        
        <h4>ğŸ“Š ì˜ì—­ë³„ ì£¼ìš” ê²°ê³¼</h4>
        <table class="data-table">
            <thead>
                <tr>
                    <th>ì˜ì—­</th>
                    <th>ì‚¬ì „ í‰ê· </th>
                    <th>ì‚¬í›„ í‰ê· </th>
                    <th>í–¥ìƒë„</th>
                    <th>íš¨ê³¼í¬ê¸°</th>
                    <th>ìœ ì˜ì„±</th>
                </tr>
            </thead>
            <tbody>
                ${['a', 'b', 'c'].map(area => {
                    const result = analysisResults[area];
                    const areaName = area === 'a' ? 'ì§€ì‹Â·ì´í•´' : area === 'b' ? 'ê³¼ì •Â·ê¸°ëŠ¥' : 'ê°€ì¹˜Â·íƒœë„';
                    return `
                        <tr>
                            <td>${areaName}</td>
                            <td>${result.pre_mean.toFixed(2)}</td>
                            <td>${result.post_mean.toFixed(2)}</td>
                            <td>+${result.improvement.toFixed(2)} (${result.improvementPercent.toFixed(1)}%)</td>
                            <td>${result.cohenD.toFixed(3)} (${result.effectSize.label})</td>
                            <td>${result.tTest.significant ? 'âœ… p<0.05' : 'âŒ n.s.'}</td>
                        </tr>
                    `;
                }).join('')}
            </tbody>
        </table>
    `;
}

// ìƒì„¸ ë³´ê³ ì„œ ìƒì„±
function generateDetailedReport() {
    const grade = currentGrade === 'elementary' ? 'ì´ˆë“±í•™êµ 5í•™ë…„' : 'ì¤‘í•™êµ 2í•™ë…„';
    const date = new Date().toLocaleDateString('ko-KR');
    
    return `
        <div class="result-card" style="margin-top: 20px;">
            <h3>ğŸ“‹ ìƒì„¸ ì—°êµ¬ ë³´ê³ ì„œ</h3>
            
            <h4>1. ì—°êµ¬ ê°œìš”</h4>
            <p><strong>ì—°êµ¬ ì œëª©:</strong> í•™ìƒì£¼ë„í˜• ì†Œë¦¬ íŠ¹ì„± ì‹¤í—˜ì¥ì¹˜ì˜ êµìœ¡ íš¨ê³¼ ê²€ì¦</p>
            <p><strong>ì—°êµ¬ ëŒ€ìƒ:</strong> ${grade} ${analysisResults.a.n}ëª…</p>
            <p><strong>ë¶„ì„ ì¼ì‹œ:</strong> ${date}</p>
            <p><strong>ì—°êµ¬ ì„¤ê³„:</strong> ì‚¬ì „-ì‚¬í›„ ì¤€ì‹¤í—˜ì„¤ê³„ (One-group pretest-posttest design)</p>
            
            <h4>2. ì¸¡ì • ë„êµ¬</h4>
            <ul>
                <li><strong>Aì˜ì—­ (ì§€ì‹Â·ì´í•´):</strong> ì˜¤ê°œë… ì§„ë‹¨ ë° ê³¼í•™ ê°œë… ì´í•´ë„ (${currentGrade === 'elementary' ? '5' : '6'}ì  ë§Œì )</li>
                <li><strong>Bì˜ì—­ (ê³¼ì •Â·ê¸°ëŠ¥):</strong> ê³„ëŸ‰ì  ì‚¬ê³  ë° ê³¼í•™ì  íƒêµ¬ ê¸°ëŠ¥ (${currentGrade === 'elementary' ? '4' : '5'}ì  ë§Œì )</li>
                <li><strong>Cì˜ì—­ (ê°€ì¹˜Â·íƒœë„):</strong> ê³¼í•™ì— ëŒ€í•œ í¥ë¯¸ ë° íƒêµ¬ ì˜ìš• (5ì  ì²™ë„)</li>
                <li><strong>Eì˜ì—­ (ì²´í—˜ í‰ê°€):</strong> ì‹¤í—˜ì¥ì¹˜ì— ëŒ€í•œ ë§Œì¡±ë„ ë° íš¨ê³¼ì„± (5ì  ì²™ë„)</li>
            </ul>
            
            <h4>3. í†µê³„ ë¶„ì„ ê²°ê³¼</h4>
            ${['a', 'b', 'c'].map(area => {
                const result = analysisResults[area];
                const areaName = area === 'a' ? 'ì§€ì‹Â·ì´í•´' : area === 'b' ? 'ê³¼ì •Â·ê¸°ëŠ¥' : 'ê°€ì¹˜Â·íƒœë„';
                return `
                    <h5>3.${['a', 'b', 'c'].indexOf(area) + 1} ${areaName} ì˜ì—­</h5>
                    <ul>
                        <li>ì‚¬ì „ê²€ì‚¬: M = ${result.pre_mean.toFixed(2)}, SD = ${result.pre_sd.toFixed(2)}</li>
                        <li>ì‚¬í›„ê²€ì‚¬: M = ${result.post_mean.toFixed(2)}, SD = ${result.post_sd.toFixed(2)}</li>
                        <li>ëŒ€ì‘í‘œë³¸ t-ê²€ì •: t(${result.tTest.df}) = ${result.tTest.tStat.toFixed(3)}, p ${result.tTest.pValue < 0.001 ? '< 0.001' : '= ' + result.tTest.pValue.toFixed(3)}</li>
                        <li>íš¨ê³¼í¬ê¸°: Cohen's d = ${result.cohenD.toFixed(3)} (${result.effectSize.label})</li>
                        <li>í–¥ìƒìœ¨: ${result.improvementPercent.toFixed(1)}%</li>
                    </ul>
                `;
            }).join('')}
            
            <h4>4. ì‹¤í—˜ ì²´í—˜ í‰ê°€ (Eì˜ì—­)</h4>
            <ul>
                <li>í‰ê·  ë§Œì¡±ë„: M = ${analysisResults.e.mean.toFixed(2)}, SD = ${analysisResults.e.sd.toFixed(2)}</li>
                <li>ì¼í‘œë³¸ t-ê²€ì • (ê¸°ì¤€ê°’ 3.0): t(${analysisResults.e.oneSampleTest.df}) = ${analysisResults.e.oneSampleTest.tStat.toFixed(3)}</li>
                <li>í•´ì„: ${analysisResults.e.mean >= 4.0 ? 'ë§¤ìš° ë†’ì€ ë§Œì¡±ë„' : 'ë†’ì€ ë§Œì¡±ë„'}</li>
            </ul>
            
            <h4>5. ê²°ë¡  ë° ì˜ì˜</h4>
            <ul>
                <li>ê°œë°œëœ ì‹¤í—˜ì¥ì¹˜ëŠ” ${['a', 'b', 'c'].filter(a => analysisResults[a].tTest.significant).length}/3ê°œ ì˜ì—­ì—ì„œ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•œ êµìœ¡ íš¨ê³¼ë¥¼ ë³´ì„</li>
                <li>íŠ¹íˆ ${['a', 'b', 'c'].filter(a => Math.abs(analysisResults[a].cohenD) >= 0.8).map(a => a === 'a' ? 'ì§€ì‹Â·ì´í•´' : a === 'b' ? 'ê³¼ì •Â·ê¸°ëŠ¥' : 'ê°€ì¹˜Â·íƒœë„').join(', ')} ì˜ì—­ì—ì„œ í° íš¨ê³¼í¬ê¸°ë¥¼ ë‚˜íƒ€ëƒ„</li>
                <li>í•™ìƒë“¤ì˜ ì‹¤í—˜ ì²´í—˜ ë§Œì¡±ë„ê°€ ë§¤ìš° ë†’ì•„ ì‹¤ì œ êµìœ¡í˜„ì¥ ì ìš© ê°€ëŠ¥ì„±ì´ ë†’ìŒ</li>
                <li>2022 ê°œì • êµìœ¡ê³¼ì •ì˜ ê³¼í•™ê³¼ í•µì‹¬ì—­ëŸ‰ í•¨ì–‘ì— íš¨ê³¼ì ì¸ êµìœ¡ë„êµ¬ë¡œ íŒë‹¨ë¨</li>
            </ul>
            
            <h4>6. ì—°êµ¬ì˜ ì œí•œì </h4>
            <ul>
                <li>ë‹¨ì¼ ì§‘ë‹¨ ì‚¬ì „-ì‚¬í›„ ì„¤ê³„ë¡œ ì¸í•œ ë‚´ì  íƒ€ë‹¹ë„ ì œì•½</li>
                <li>í‘œë³¸ í¬ê¸°ì™€ ëŒ€ìƒ í•™êµì˜ ì œí•œ</li>
                <li>ì¥ê¸°ì  í•™ìŠµ íš¨ê³¼ì— ëŒ€í•œ ì¶”ì  ì—°êµ¬ í•„ìš”</li>
            </ul>
        </div>
    `;
}

// CSV ë‚´ë³´ë‚´ê¸° í•¨ìˆ˜
function exportToCSV() {
    const data = collectData();
    if (data.length === 0) {
        alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    // CSV í—¤ë”
    const headers = [
        'í•™ìƒID', 'ì„±ë³„', 'Aì˜ì—­_ì‚¬ì „', 'Aì˜ì—­_ì‚¬í›„', 'Aì˜ì—­_í–¥ìƒ',
        'Bì˜ì—­_ì‚¬ì „', 'Bì˜ì—­_ì‚¬í›„', 'Bì˜ì—­_í–¥ìƒ',
        'Cì˜ì—­_ì‚¬ì „', 'Cì˜ì—­_ì‚¬í›„', 'Cì˜ì—­_í–¥ìƒ',
        'Eì˜ì—­_í‰ê· ', 'ì´_í–¥ìƒë„'
    ];
    
    // CSV ë°ì´í„°
    const csvData = data.map(student => [
        student.id,
        student.gender,
        student.a_pre,
        student.a_post,
        student.a_post - student.a_pre,
        student.b_pre,
        student.b_post,
        student.b_post - student.b_pre,
        student.c_pre,
        student.c_post,
        student.c_post - student.c_pre,
        student.e_avg,
        (student.a_post - student.a_pre) + (student.b_post - student.b_pre) + (student.c_post - student.c_pre)
    ]);
    
    // CSV ë¬¸ìì—´ ìƒì„±
    const csvContent = [headers, ...csvData]
        .map(row => row.join(','))
        .join('\n');
    
    // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
    const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', `ì‹¤í—˜ì¥ì¹˜_ë¶„ì„ê²°ê³¼_${new Date().toISOString().slice(0, 10)}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    console.log('CSV íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
}

// ë³´ê³ ì„œ ì¸ì‡„ í•¨ìˆ˜
function printReport() {
    const reportContent = document.getElementById('report-content').innerHTML;
    const detailedContent = document.getElementById('detailed-report').innerHTML;
    
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <html>
        <head>
            <title>ì‹¤í—˜ì¥ì¹˜ êµìœ¡ íš¨ê³¼ ë¶„ì„ ë³´ê³ ì„œ</title>
            <style>
                body { font-family: 'Malgun Gothic', Arial, sans-serif; margin: 20px; }
                .alert { padding: 15px; border-radius: 5px; margin: 15px 0; }
                .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
                .data-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                .data-table th, .data-table td { border: 1px solid #dee2e6; padding: 12px; text-align: center; }
                .data-table th { background: #007bff; color: white; }
                h3, h4, h5 { color: #2c3e50; }
                @media print { body { margin: 0; } }
            </style>
        </head>
        <body>
            <h1>í•™ìƒì£¼ë„í˜• ì†Œë¦¬ íŠ¹ì„± ì‹¤í—˜ì¥ì¹˜ êµìœ¡ íš¨ê³¼ ë¶„ì„ ë³´ê³ ì„œ</h1>
            <p>ìƒì„±ì¼: ${new Date().toLocaleDateString('ko-KR')}</p>
            <hr>
            ${reportContent}
            ${detailedContent}
        </body>
        </html>
    `);
    
    printWindow.document.close();
    printWindow.print();
}

// ê²°ê³¼ ë³µì‚¬ í•¨ìˆ˜
function copyResults() {
    const summary = generateTextSummary();
    
    if (navigator.clipboard) {
        navigator.clipboard.writeText(summary).then(() => {
            alert('ë¶„ì„ ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        });
    } else {
        // í´ë°±: í…ìŠ¤íŠ¸ ì˜ì—­ ìƒì„±í•˜ì—¬ ë³µì‚¬
        const textArea = document.createElement('textarea');
        textArea.value = summary;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('ë¶„ì„ ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }
}

// í…ìŠ¤íŠ¸ ìš”ì•½ ìƒì„±
function generateTextSummary() {
    const n = analysisResults.a.n;
    const grade = currentGrade === 'elementary' ? 'ì´ˆë“±í•™êµ 5í•™ë…„' : 'ì¤‘í•™êµ 2í•™ë…„';
    
    return `
í•™ìƒì£¼ë„í˜• ì†Œë¦¬ íŠ¹ì„± ì‹¤í—˜ì¥ì¹˜ êµìœ¡ íš¨ê³¼ ë¶„ì„ ê²°ê³¼

ì—°êµ¬ ëŒ€ìƒ: ${grade} ${n}ëª…
ë¶„ì„ ì¼ì‹œ: ${new Date().toLocaleDateString('ko-KR')}

== ì˜ì—­ë³„ ë¶„ì„ ê²°ê³¼ ==
${['a', 'b', 'c'].map(area => {
    const result = analysisResults[area];
    const areaName = area === 'a' ? 'Aì˜ì—­(ì§€ì‹Â·ì´í•´)' : area === 'b' ? 'Bì˜ì—­(ê³¼ì •Â·ê¸°ëŠ¥)' : 'Cì˜ì—­(ê°€ì¹˜Â·íƒœë„)';
    return `
${areaName}:
- ì‚¬ì „: ${result.pre_mean.toFixed(2)} Â± ${result.pre_sd.toFixed(2)}
- ì‚¬í›„: ${result.post_mean.toFixed(2)} Â± ${result.post_sd.toFixed(2)}
- í–¥ìƒ: +${result.improvement.toFixed(2)}ì  (${result.improvementPercent.toFixed(1)}%)
- í†µê³„: t(${result.tTest.df}) = ${result.tTest.tStat.toFixed(3)}, p ${result.tTest.pValue < 0.001 ? '<0.001' : '=' + result.tTest.pValue.toFixed(3)}
- íš¨ê³¼í¬ê¸°: d = ${result.cohenD.toFixed(3)} (${result.effectSize.label})
`;
}).join('')}

ì‹¤í—˜ ì²´í—˜ í‰ê°€: ${analysisResults.e.mean.toFixed(2)}/5.0ì 

ê²°ë¡ : ${['a', 'b', 'c'].filter(a => analysisResults[a].tTest.significant).length}/3ê°œ ì˜ì—­ì—ì„œ ìœ ì˜í•œ íš¨ê³¼, ${['a', 'b', 'c'].filter(a => Math.abs(analysisResults[a].cohenD) >= 0.8).length}ê°œ ì˜ì—­ì—ì„œ í° íš¨ê³¼í¬ê¸°
    `.trim();
}

// Part 4B í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
function testPart4B() {
    console.log('ğŸ¯ Part 4B (ë³´ê³ ì„œ ìƒì„±) í•¨ìˆ˜ë“¤ ë¡œë“œ ì™„ë£Œ!');
    
    const functions = {
        generateReport: typeof generateReport,
        generateSummaryReport: typeof generateSummaryReport,
        generateDetailedReport: typeof generateDetailedReport,
        exportToCSV: typeof exportToCSV,
        printReport: typeof printReport,
        copyResults: typeof copyResults,
        generateTextSummary: typeof generateTextSummary
    };
    
    console.log('Part 4B í•¨ìˆ˜ í™•ì¸:', functions);
    return functions;
}

// Part 4B ë¡œë“œ ì™„ë£Œ ì‹œ ìë™ ì‹¤í–‰
if (typeof document !== 'undefined') {
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof testPart4B === 'function') {
            testPart4B();
        }
    });
}

console.log('ğŸ“‹ Part 4B JavaScript ë¡œë“œ ì™„ë£Œ!');

// ========================================
// ì „ì²´ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ë° í†µí•© í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
// ========================================

// ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
function testFullSystem() {
    console.log('ğŸš€ ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘!');
    
    const results = {
        part1: typeof showTab !== 'undefined',
        part2: typeof addStudent !== 'undefined',
        part3: typeof calculateResults !== 'undefined',
        part4a: typeof createCharts !== 'undefined',
        part4b: typeof generateReport !== 'undefined'
    };
    
    const allLoaded = Object.values(results).every(Boolean);
    
    console.log('íŒŒíŠ¸ë³„ ë¡œë“œ ìƒíƒœ:', results);
    console.log('ì „ì²´ ì‹œìŠ¤í…œ ìƒíƒœ:', allLoaded ? 'âœ… ì™„ë£Œ' : 'âŒ ë¶ˆì™„ì „');
    
    if (allLoaded) {
        console.log('ğŸ‰ ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        console.log('ğŸ’¡ ì‚¬ìš©ë²•:');
        console.log('1. í•™ê¸‰ ì„ íƒ (ì´ˆ5/ì¤‘2)');
        console.log('2. í•™ìƒ ì¶”ê°€ ë˜ëŠ” ìƒ˜í”Œ ë°ì´í„° ë¡œë“œ');
        console.log('3. ë¶„ì„ ì‹¤í–‰ ë²„íŠ¼ í´ë¦­');
        console.log('4. ê²°ê³¼ í™•ì¸ ë° ë³´ê³ ì„œ ìƒì„±');
    } else {
        console.log('âš ï¸ ì¼ë¶€ ê¸°ëŠ¥ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. íŒŒíŠ¸ë³„ ì½”ë“œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
    }
    
    return { results, allLoaded };
}

// DOM ë¡œë“œ ì™„ë£Œ ì‹œ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(testFullSystem, 1000); // 1ì´ˆ í›„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
});

console.log('ğŸ¯ ì „ì²´ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ!');
</script>



</body>
</html>